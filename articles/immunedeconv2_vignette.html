<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>immunedeconv2_vignette • immunedeconv2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="immunedeconv2_vignette">
<meta property="og:description" content="immunedeconv2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">immunedeconv2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/immunedeconv2_vignette.html">immunedeconv2_vignette</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/PelzKo/immunedeconv2/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="immunedeconv2_vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>immunedeconv2_vignette</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PelzKo/immunedeconv2/blob/master/vignettes/immunedeconv2_vignette.Rmd"><code>vignettes/immunedeconv2_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>immunedeconv2_vignette.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>1. Introduction</h1>
<p>Cell-type heterogeneity is a strong confounder as well as source of information in bulk RNA sequencing (RNA-seq) data. Computational methods for the deconvolution of bulk RNA-seq data can infer the cellular composition of heterogeneous samples by leveraging precomputed expression signatures that represent the transcriptional profiles of the cell types of interest. Second-generation deconvolution tools allow deriving cell-type-specific expression signatures from single-cell RNA-seq (scRNA-seq) enabling, in principle, the deconvolution of any cell type profiled with single-cell technologies.</p>
<p>Our interface unifies multiple second-generation deconvolution methods to facilitate the usage of these tools and clear the way for future benchmarking of these methods.</p>
</div>
<div id="deconvolution" class="section level1">
<h1 class="hasAnchor">
<a href="#deconvolution" class="anchor"></a>2. Deconvolution</h1>
<p>In this section, we want to give an overview about the different methods and provide an example of how to use them.</p>
<div id="installation-and-setup" class="section level2">
<h2 class="hasAnchor">
<a href="#installation-and-setup" class="anchor"></a>Installation and Setup</h2>
<p>Install the CRAN package devtools and use it to install immunedeconv2 from <a href="https://github.com/">GitHub</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"PelzKo/immunedeconv2"</span><span class="op">)</span></code></pre></div>
</div>
<div id="input-data" class="section level2">
<h2 class="hasAnchor">
<a href="#input-data" class="anchor"></a>Input Data</h2>
<p>First of all, you need some data to run the deconvolution with.</p>
<ul>
<li>Single cell RNA-seq data
<ul>
<li>
<em>Genes</em> x <em>Cells</em> matrix</li>
<li>Counts are <em>TPM normalized</em>, <em>not log-transformed</em>
</li>
<li>Rownames (genenames) are provided in the same format as in the bulk RNA-seq data, for instance HGNC symbols</li>
</ul>
</li>
<li>Cell type annotations
<ul>
<li>Vector containing cell type annotations</li>
<li>Annotations are in the same order as the columns of the single cell matrix</li>
</ul>
</li>
<li>Bulk RNA-seq data
<ul>
<li>
<em>Genes</em> x <em>Samples</em> matrix</li>
<li>Rownames (genenames) are provided in the same format as in the sc RNA-seq data, for instance HGNC symbols</li>
</ul>
</li>
</ul>
<p>We also provide some sample data, a bigger and a smaller set of single cell RNA-seq matrix (Maynard et al. 2020), cell type annotations and bulk RNA-seq matrix (Hoek et al. 2015). You can simply load it with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"single_cell_data"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"cell_type_annotations"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"bulk"</span><span class="op">)</span></code></pre></div>
<p>For the small dataset, append "_small" to the names, e.g. </p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"single_cell_data_small"</span><span class="op">)</span></code></pre></div>
</div>
<div id="signature-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#signature-matrix" class="anchor"></a>Signature Matrix</h2>
<p>To calculate a cell-type-specific expression signature, you can use the build_model function using the single cell RNA-seq matrix and cell type annotations specified above. The parameter method can be set to one of the four methods listed below. More information of the methods is provided in section 3.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">immunedeconv2</span><span class="fu">::</span><span class="fu"><a href="../reference/build_model.html">build_model</a></span><span class="op">(</span><span class="va">single_cell_data</span>, <span class="va">cell_type_annotations</span>, <span class="va">method</span><span class="op">)</span></code></pre></div>
<ul>
<li>Bisque (“bisque”)</li>
<li>DWLS (“dwls”)</li>
<li>MOMF (“momf”)</li>
<li>Scaden (“scaden”)</li>
<li>CibersortX (“cibersortx”)</li>
</ul>
<p>Note: MOMF and Scaden also need the bulk RNA-seq data to calculate a signature matrix. Please provide this parameter as well when running build_model with one of these two methods.</p>
<p>Additional parameters for the different methods can be included in the method call as well. For further information on which options you have, see the documentation of each tool.</p>
</div>
<div id="deconvolution-of-bulk-rna-seq-data" class="section level2">
<h2 class="hasAnchor">
<a href="#deconvolution-of-bulk-rna-seq-data" class="anchor"></a>Deconvolution of Bulk RNA-seq Data</h2>
<p>After building the specific signature matrix, you can calculate the cell properties in bulk RNA-seq data with the deconvolute function. For this, you need to provide the bulk data, signature matrix and you can, again, choose between the four methods listed in the previous section.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">immunedeconv2</span><span class="fu">::</span><span class="fu"><a href="../reference/deconvolute.html">deconvolute</a></span><span class="op">(</span><span class="va">bulk</span>, <span class="va">signature_matrix</span>, <span class="va">method</span><span class="op">)</span></code></pre></div>
<p>Note: Bisque and MOMF additionally need the single cell RNA-seq matrix, that you already used to build the signature matrix, for their deconvolution. As a fifth parameter, Bisque also needs cell type annotations, which were also already needed for building the model.</p>
<p>As for the build_model function, specific parameters can be passed on to the deconvolution methods.</p>
</div>
<div id="example-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#example-workflow" class="anchor"></a>Example Workflow</h2>
<p>This workflow provides a more detailed example of how to run the deconvolution with Bisque.</p>
<p>First of all, make sure you load all the libraries we need for this analysis. If the packages are not available, install them via install_packages().</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PelzKo/immunedeconv2">immunedeconv2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://Rdatatable.gitlab.io/data.table">data.table</a></span><span class="op">)</span></code></pre></div>
<p>To give you a feeling for the data, this is what the first few rows and columns of our small single cell RNA-seq dataset look like:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">single_cell_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">SRR10797331</th>
<th align="right">SRR10784783</th>
<th align="right">SRR10791871</th>
<th align="right">SRR10783889</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">TSPAN6</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">FGR</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">CYP51A1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">AOC1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">WNT16</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Now we build the signature matrix with Bisque and look at the values for the first few genes.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">signatureMatrix</span> <span class="op">&lt;-</span> <span class="fu">immunedeconv2</span><span class="fu">::</span><span class="fu"><a href="../reference/build_model.html">build_model</a></span><span class="op">(</span><span class="va">single_cell_data</span>, <span class="va">cell_type_annotations</span>, <span class="st">"bisque"</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">signatureMatrix</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="6%">
<col width="7%">
<col width="15%">
<col width="18%">
<col width="6%">
<col width="7%">
<col width="7%">
<col width="11%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">B cell</th>
<th align="right">Macrophage</th>
<th align="right">Monocyte conventional</th>
<th align="right">Monocyte non-conventional</th>
<th align="right">NK cell</th>
<th align="right">T cell CD4</th>
<th align="right">T cell CD8</th>
<th align="right">T cell dividing</th>
<th align="right">T cell regulatory</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">TSPAN6</td>
<td align="right">0.00000</td>
<td align="right">0.0224404</td>
<td align="right">0.00000</td>
<td align="right">0.000000</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.000000</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">FGR</td>
<td align="right">14.43455</td>
<td align="right">30.7676144</td>
<td align="right">313.40391</td>
<td align="right">180.407874</td>
<td align="right">77.97797</td>
<td align="right">0.1278529</td>
<td align="right">0.7800284</td>
<td align="right">0.000000</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">CYP51A1</td>
<td align="right">30.79303</td>
<td align="right">10.9460034</td>
<td align="right">13.19608</td>
<td align="right">5.456035</td>
<td align="right">22.90308</td>
<td align="right">11.1332235</td>
<td align="right">20.7037599</td>
<td align="right">9.325876</td>
<td align="right">20.4159</td>
</tr>
<tr class="even">
<td align="left">AOC1</td>
<td align="right">0.00000</td>
<td align="right">0.0900427</td>
<td align="right">0.00000</td>
<td align="right">8.219547</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.000000</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">WNT16</td>
<td align="right">11.65795</td>
<td align="right">0.0309828</td>
<td align="right">0.00000</td>
<td align="right">0.000000</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.000000</td>
<td align="right">0.0000</td>
</tr>
</tbody>
</table>
<p>We can use this signature matrix to run the deconvolution with Bisque.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">immunedeconv2</span><span class="fu">::</span><span class="fu"><a href="../reference/deconvolute.html">deconvolute</a></span><span class="op">(</span><span class="va">bulk</span>, <span class="va">signatureMatrix</span>, <span class="st">"bisque"</span>, <span class="va">single_cell_data</span>, <span class="va">cell_type_annotations</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="6%">
<col width="7%">
<col width="14%">
<col width="17%">
<col width="6%">
<col width="7%">
<col width="7%">
<col width="10%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">B cell</th>
<th align="right">Macrophage</th>
<th align="right">Monocyte conventional</th>
<th align="right">Monocyte non conventional</th>
<th align="right">NK cell</th>
<th align="right">T cell CD4</th>
<th align="right">T cell CD8</th>
<th align="right">T cell dividing</th>
<th align="right">T cell regulatory</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">HD30_PBMC_0</td>
<td align="right">0.0000000</td>
<td align="right">0.3538763</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.1740958</td>
<td align="right">0.0000000</td>
<td align="right">0.0506317</td>
<td align="right">0.4213961</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">HD30_PBMC_1</td>
<td align="right">0.0000000</td>
<td align="right">0.1136076</td>
<td align="right">0.0000000</td>
<td align="right">0.2588127</td>
<td align="right">0.1689959</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.4585839</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">HD30_PBMC_3</td>
<td align="right">0.0000000</td>
<td align="right">0.1483928</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.2431386</td>
<td align="right">0.3459540</td>
<td align="right">0.0000000</td>
<td align="right">0.2625147</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">HD30_PBMC_7</td>
<td align="right">0.0000000</td>
<td align="right">0.2308434</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.1853657</td>
<td align="right">0.0000000</td>
<td align="right">0.4179878</td>
<td align="right">0.1658031</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">HD31_PBMC_0</td>
<td align="right">0.0000000</td>
<td align="right">0.5108072</td>
<td align="right">0.3647978</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.1243950</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">HD31_PBMC_1</td>
<td align="right">0.0000000</td>
<td align="right">0.3681902</td>
<td align="right">0.1929607</td>
<td align="right">0.2083132</td>
<td align="right">0.0000000</td>
<td align="right">0.2305358</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">HD31_PBMC_3</td>
<td align="right">0.1603286</td>
<td align="right">0.1429087</td>
<td align="right">0.2630120</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.2268409</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.2069098</td>
</tr>
<tr class="even">
<td align="left">HD31_PBMC_7</td>
<td align="right">0.0000000</td>
<td align="right">0.4834342</td>
<td align="right">0.1360895</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0711957</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.3092806</td>
</tr>
</tbody>
</table>
</div>
<div id="plot-results" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-results" class="anchor"></a>Plot Results</h2>
<p>Here are some further ideas of how you could plot your deconvolution results.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res_bisque</span> <span class="op">&lt;-</span> <span class="fu">immunedeconv2</span><span class="fu">::</span><span class="fu"><a href="../reference/deconvolute.html">deconvolute</a></span><span class="op">(</span><span class="va">bulk</span>, <span class="va">signatureMatrix</span>, <span class="st">"bisque"</span>, <span class="va">single_cell_data</span>, <span class="va">cell_type_annotations</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="va">res_bisque</span>, samples<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">res_bisque</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">samples</span>, names_to <span class="op">=</span><span class="st">"cell_type"</span>, values_to<span class="op">=</span><span class="st">"predicted_fraction"</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">samples</span>, x<span class="op">=</span><span class="va">predicted_fraction</span>, fill<span class="op">=</span><span class="va">cell_type</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Bisque"</span>, y<span class="op">=</span><span class="st">"sample"</span>, x<span class="op">=</span><span class="st">"proportion"</span>, fill<span class="op">=</span><span class="st">"cell type"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Paired"</span><span class="op">)</span></code></pre></div>
<p><img src="immunedeconv2_vignette_files/figure-html/plot-1.png" width="672"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"images/bisque_prop.png"</span>, width <span class="op">=</span> <span class="fl">7</span>, height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="va">res_bisque</span>, samples<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">res_bisque</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">samples</span>, names_to <span class="op">=</span><span class="st">"cell_type"</span>, values_to<span class="op">=</span><span class="st">"predicted_fraction"</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">samples</span>, x<span class="op">=</span><span class="va">predicted_fraction</span>, color<span class="op">=</span><span class="va">cell_type</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">cell_type</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Bisque"</span>, y<span class="op">=</span><span class="st">"sample"</span>, x<span class="op">=</span><span class="st">"predicted fraction"</span>, color<span class="op">=</span><span class="st">"cell type"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Paired"</span><span class="op">)</span></code></pre></div>
<p><img src="immunedeconv2_vignette_files/figure-html/plot-2.png" width="672"> In the next figures you can see, how the other methods are used and how the cell proportions would be distributed based on their calculations. Here are some further ideas of how you could plot your deconvolution results.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res_momf</span> <span class="op">&lt;-</span> <span class="fu">immunedeconv2</span><span class="fu">::</span><span class="fu"><a href="../reference/build_model.html">build_model</a></span><span class="op">(</span><span class="va">single_cell_data</span>, <span class="va">cell_type_annotations</span>, <span class="st">"momf"</span>, <span class="va">bulk</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu">immunedeconv2</span><span class="fu">::</span><span class="fu"><a href="../reference/deconvolute.html">deconvolute</a></span><span class="op">(</span>bulk_gene_expression <span class="op">=</span> <span class="va">bulk</span>, method <span class="op">=</span> <span class="st">"momf"</span>, single_cell_object <span class="op">=</span> <span class="va">single_cell_data</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="va">res_bisque</span>, samples<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">res_bisque</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">samples</span>, names_to <span class="op">=</span><span class="st">"cell_type"</span>, values_to<span class="op">=</span><span class="st">"predicted_fraction"</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">samples</span>, x<span class="op">=</span><span class="va">predicted_fraction</span>, fill<span class="op">=</span><span class="va">cell_type</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"MOMF"</span>, y<span class="op">=</span><span class="st">"sample"</span>, x<span class="op">=</span><span class="st">"proportion"</span>, fill<span class="op">=</span><span class="st">"cell type"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Paired"</span><span class="op">)</span>

<span class="va">res_scaden</span> <span class="op">&lt;-</span> <span class="fu">immunedeconv2</span><span class="fu">::</span><span class="fu"><a href="../reference/build_model.html">build_model</a></span><span class="op">(</span>single_cell_object <span class="op">=</span> <span class="va">single_cell_data</span>, cell_type_annotations <span class="op">=</span> <span class="va">cell_type_annotations</span>, method <span class="op">=</span> <span class="st">"scaden"</span>, <span class="va">bulk</span><span class="op">)</span> <span class="op">%&gt;%</span>
 <span class="fu">immunedeconv2</span><span class="fu">::</span><span class="fu"><a href="../reference/deconvolute.html">deconvolute</a></span><span class="op">(</span>bulk_gene_expression <span class="op">=</span> <span class="va">bulk</span>, method <span class="op">=</span> <span class="st">"scaden"</span>, single_cell_object <span class="op">=</span> <span class="va">single_cell_data</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="va">res_bisque</span>, samples<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">res_bisque</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">samples</span>, names_to <span class="op">=</span><span class="st">"cell_type"</span>, values_to<span class="op">=</span><span class="st">"predicted_fraction"</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">samples</span>, x<span class="op">=</span><span class="va">predicted_fraction</span>, fill<span class="op">=</span><span class="va">cell_type</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Scaden"</span>, y<span class="op">=</span><span class="st">"sample"</span>, x<span class="op">=</span><span class="st">"proportion"</span>, fill<span class="op">=</span><span class="st">"cell type"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Paired"</span><span class="op">)</span>

<span class="va">res_dwls</span> <span class="op">&lt;-</span> <span class="fu">immunedeconv2</span><span class="fu">::</span><span class="fu"><a href="../reference/build_model.html">build_model</a></span><span class="op">(</span><span class="va">single_cell_data</span>, <span class="va">cell_type_annotations</span>, <span class="st">"dwls"</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu">immunedeconv2</span><span class="fu">::</span><span class="fu"><a href="../reference/deconvolute.html">deconvolute</a></span><span class="op">(</span>bulk_gene_expression <span class="op">=</span> <span class="va">bulk</span>, method <span class="op">=</span> <span class="st">"dwls"</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="va">res_bisque</span>, samples<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">res_bisque</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">samples</span>, names_to <span class="op">=</span><span class="st">"cell_type"</span>, values_to<span class="op">=</span><span class="st">"predicted_fraction"</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">samples</span>, x<span class="op">=</span><span class="va">predicted_fraction</span>, fill<span class="op">=</span><span class="va">cell_type</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"DWLS"</span>, y<span class="op">=</span><span class="st">"sample"</span>, x<span class="op">=</span><span class="st">"proportion"</span>, fill<span class="op">=</span><span class="st">"cell type"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Paired"</span><span class="op">)</span>

<span class="va">res_ciber</span> <span class="op">&lt;-</span> <span class="fu">immunedeconv2</span><span class="fu">::</span><span class="fu"><a href="../reference/build_model.html">build_model</a></span><span class="op">(</span><span class="va">single_cell_data</span>, <span class="va">cell_type_annotations</span>, <span class="st">"cibersortx"</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu">immunedeconv2</span><span class="fu">::</span><span class="fu"><a href="../reference/deconvolute.html">deconvolute</a></span><span class="op">(</span>bulk_gene_expression <span class="op">=</span> <span class="va">bulk</span>, method <span class="op">=</span> <span class="st">"cibersortx"</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="va">res_bisque</span>, samples<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">res_bisque</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">samples</span>, names_to <span class="op">=</span><span class="st">"cell_type"</span>, values_to<span class="op">=</span><span class="st">"predicted_fraction"</span><span class="op">)</span> <span class="op">%&gt;%</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">samples</span>, x<span class="op">=</span><span class="va">predicted_fraction</span>, fill<span class="op">=</span><span class="va">cell_type</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"CibersortX"</span>, y<span class="op">=</span><span class="st">"sample"</span>, x<span class="op">=</span><span class="st">"proportion"</span>, fill<span class="op">=</span><span class="st">"cell type"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Paired"</span><span class="op">)</span></code></pre></div>
<p><img src="images/momf_prop.png" width="80%"><img src="images/scaden_prop.png" width="80%"><img src="images/dwls_prop.png" width="80%"><img src="images/cibersortx_prop.png" width="80%"></p>
</div>
</div>
<div id="methods" class="section level1">
<h1 class="hasAnchor">
<a href="#methods" class="anchor"></a>3. Methods</h1>
<p>In this section, we provide a short overview over the deconvolution tools that can be used via this package.</p>
<div id="bisque" class="section level2">
<h2 class="hasAnchor">
<a href="#bisque" class="anchor"></a>Bisque</h2>
<p>Bisque(Jew et al., 2020) takes advantage of matched bulk and scRNA-seq samples to improve accuracy of cell-type estimates. Using linear regression, it corrects for platform-specific biases between pseudo-bulk reference profiles derived from scRNA-seq and bulk RNA-seq samples. It then applies NNLS-regression to deconvolute other bulk RNA-seq samples.</p>
<p>Citation: Jew, B., Alvarez, M., Rahmani, E., Miao, Z., Ko, A., Garske, K. M., Sul, J. H., Pietiläinen, K. H., Pajukanta, P., &amp; Halperin, E. (2020). Publisher Correction: Accurate estimation of cell composition in bulk expression through robust integration of single-cell information. Nature Communications, 11(1), 2891. <a href="https://doi.org/10.1038/s41467-020-16607-9" class="uri">https://doi.org/10.1038/s41467-020-16607-9</a></p>
</div>
<div id="dwls" class="section level2">
<h2 class="hasAnchor">
<a href="#dwls" class="anchor"></a>DWLS</h2>
<p>Tsoucas et al(Tsoucas et al., 2019) introduce dampened weighted least squares (DWLS)-regression, which improves over ordinary least squares regression or 𝜈-SVR in that it attributes higher weight to rare cell types and marker genes with a low average expression level. They show that their method achieves favorable performance when estimating the abundance of infrequent cell-types.</p>
<p>Citation: Tsoucas, D., Dong, R., Chen, H., Zhu, Q., Guo, G., &amp; Yuan, G.-C. (2019). Accurate estimation of cell-type composition from gene expression data. Nature Communications, 10(1), 2975. <a href="https://doi.org/10.1038/s41467-019-10802-z" class="uri">https://doi.org/10.1038/s41467-019-10802-z</a></p>
</div>
<div id="momf" class="section level2">
<h2 class="hasAnchor">
<a href="#momf" class="anchor"></a>MOMF</h2>
<p>With MOMF (Sun et al., 2019), Multi-Omics Matrix Factorization, models the cell type specific mean in sc RNA-seq data by also accounting for the uncertainty of these cell type specific mean gene expression levels. Alternating Direction Method of Multipliers algorithm is then used to estimate the parameters in bulk RNA-seq downstream analyses.</p>
<p>Citation: Xifang Sun, Shiquan Sun, and Sheng Yang. An efficient and flexible method for deconvoluting bulk RNAseq data with single-cell RNAseq data, 2019, DIO: 10.5281/zenodo.3373980</p>
</div>
<div id="scaden" class="section level2">
<h2 class="hasAnchor">
<a href="#scaden" class="anchor"></a>Scaden</h2>
<p>Scaden(Menden et al., n.d.) leverages a deep neural network (DNN) for estimating cell-type proportions. Instead of explicitly building a signature matrix, the DNN implicitly learns which features are important for a certain cell type. The DNN is trained by simulating bulk RNA-seq samples with known cell-type proportions from scRNA-seq datasets. To increase robustness, the training process allows to flexibly integrate multiple scRNA-seq datasets and, optionally, bulk RNA-seq samples with “gold standard” measurements such as FACS.</p>
<p>Citation: Menden, K., Marouf, M., Oller, S., Dalmia, A., Kloiber, K., Heutink, P., &amp; Bonn, S. (n.d.). Deep-learning-based cell composition analysis from tissue expression profiles. <a href="https://doi.org/10.1101/659227" class="uri">https://doi.org/10.1101/659227</a></p>
</div>
<div id="benchmarking" class="section level2">
<h2 class="hasAnchor">
<a href="#benchmarking" class="anchor"></a>Benchmarking</h2>
<p>In the following section, we compare the deconvolution results of all methods with the ground truth, that was measured with FACS by Hoek et al. If the methods estimated the cell type fractions perfectly, we would expect the points to be on the diagonal line displayed in each facet. Note that the results are not fully representative as we only use a small subset of cells from the analysis of Hoek et al.</p>
<p><img src="images/predictionVsGroundtruth.png" width="80%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Konstantin Pelz, Nicolas Goedert, Yuyu Liang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
